- _ulid: 01KEZFXCM3WEMMRGFDZSJSRARJ
  slugs:
    - task-cli-polish
  title: CLI output refinement and polish
  type: task
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 3
  tags:
    - cli
    - ux
  vcs_refs: []
  created_at: '2026-01-15T00:12:01.539Z'
  notes:
    - _ulid: 01KEZFXP1JPK4VBWDXTK2Q00AP
      created_at: '2026-01-15T00:12:11.187Z'
      author: '@claude'
      content: |-
        Placeholder for CLI refinement work. Known items:

        - Color consistency pass (labels vs values, status colors)
        - Consider adding spec get command for viewing spec details directly
        - Review output density/formatting across commands
        - Potential: depends_on/relates_to expansion in spec view
      supersedes: null
  todos: []
- _ulid: 01KEZG58FJDPVYND9ZWX264WF2
  slugs:
    - task-alignment-system
  title: Design spec-implementation alignment system
  type: spike
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 2
  tags:
    - core
    - process
  vcs_refs: []
  created_at: '2026-01-15T00:16:19.442Z'
  notes:
    - _ulid: 01KEZG5N9BTACBWVPNVYDGQ7BC
      created_at: '2026-01-15T00:16:32.556Z'
      author: '@claude'
      content: >-
        Problem: Spec, tasks, and implementation drift apart over time.


        Examples of drift:

        - Task @task-reference-resolution spec says nothing about dynamic ULID shortening, but that
        became a key implementation detail

        - User requests during implementation add features not in original spec

        - Implementation discoveries change the approach


        Goals:

        1. Keep specs as accurate source of truth

        2. Make drift visible and actionable

        3. Guide agents to update specs when deviating

        4. Enable reconciliation after the fact


        Potential mechanisms:


        PROACTIVE (during work):

        - Task start: show spec, prompt for planned deviations

        - Task complete: verify against acceptance criteria, prompt for spec updates

        - Agent instructions mandating spec updates when deviating


        REACTIVE (backprop):

        - kspec reconcile: compare task notes to spec, flag drift

        - Generate spec update suggestions from implementation notes

        - Mark specs 'needs-review' when notes mention unlisted changes


        STRUCTURAL:

        - Acceptance criteria as verifiable checkboxes

        - 'implementation_notes' field on spec items

        - Spec versioning when updated post-implementation

        - Deviation tracking on tasks


        Deliverables:

        1. Add spec items to spec/modules/ defining alignment features

        2. Create implementation tasks from the spec

        3. Update AGENTS.md with alignment guidance
      supersedes: null
  todos: []
- _ulid: 01KEZH1HE2TKG8Z79XW7G0Y016
  slugs:
    - task-local-cli-setup
  title: Set up local CLI development workflow
  type: task
  spec_ref: null
  status: completed
  blocked_by: []
  closed_reason: Build fixed, global install working, documented usage
  depends_on: []
  context: []
  priority: 2
  tags:
    - dx
    - cli
  vcs_refs: []
  created_at: '2026-01-15T00:31:46.114Z'
  started_at: '2026-01-15T00:32:00.757Z'
  completed_at: '2026-01-15T00:33:00.493Z'
  notes:
    - _ulid: 01KEZH1T305WYZZE596KNCQZK3
      created_at: '2026-01-15T00:31:54.976Z'
      author: '@claude'
      content: |-
        Goal: Enable kspec and kspec-dev commands for local usage.

        Plan:
        1. Verify/fix build process (npm run build)
        2. Test global install (npm install -g .)
        3. Document shell alias for kspec-dev
        4. Add dev script to package.json for portability

        Setup:
        - kspec: stable built version via global install
        - kspec-dev: alias to tsx src/cli/index.ts (live source)
      supersedes: null
    - _ulid: 01KEZH3MA5QPXCA6A6535W51Q5
      created_at: '2026-01-15T00:32:54.598Z'
      author: '@claude'
      content: |-
        Completed setup:

        1. Fixed TypeScript build error (cast through unknown)
        2. Build works: npm run build
        3. Global install works: npm install -g .
        4. kspec command available globally

        Usage:
        - Stable: kspec tasks ready
        - Dev: npm run dev -- tasks ready

        Optional shell alias for convenience (add to ~/.bashrc or ~/.zshrc):
          alias kspec-dev='npx tsx /home/chapel/Projects/kynetic-spec/src/cli/index.ts'

        To update stable version:
          npm run build && npm install -g .
      supersedes: null
  todos: []
- _ulid: 01KEZJ3E5W74AAF87Q57GTNNM6
  slugs:
    - task-author-env
  title: Auto-detect author from environment (Claude Code integration)
  type: task
  spec_ref: null
  status: completed
  blocked_by: []
  closed_reason: >-
    Implemented getAuthor() with env detection fallback chain, updated createNote() to use it,
    rewrote README with agent integration docs
  depends_on: []
  context: []
  priority: 3
  tags:
    - dx
    - integration
  vcs_refs: []
  created_at: '2026-01-15T00:50:16.892Z'
  started_at: '2026-01-15T01:24:19.102Z'
  completed_at: '2026-01-15T01:26:34.695Z'
  notes:
    - _ulid: 01KEZJ3QN4ZD7TMZ1X4TBMGC52
      created_at: '2026-01-15T00:50:26.597Z'
      author: '@claude'
      content: >-
        Problem: Notes created by Claude show author as 'unknown' because there's no way to
        auto-detect the author.


        Research findings - Claude Code environment:


        1. Claude Code does NOT set a self-identification env var automatically


        2. Two ways to configure it:

           Option A - Settings env (simplest):
           Add to ~/.claude/settings.json:
           {
             "env": {
               "KSPEC_AUTHOR": "@claude"
             }
           }

           Option B - SessionStart hook:
           {
             "hooks": {
               "SessionStart": [{
                 "type": "command",
                 "command": "echo 'export KSPEC_AUTHOR=@claude' >> \"\$CLAUDE_ENV_FILE\""
               }]
             }
           }

        3. Available Claude Code variables:
           - CLAUDE_PROJECT_DIR: project root path
           - CLAUDE_CODE_REMOTE: 'true' if web/remote session
           - Hook inputs have session_id, transcript_path, etc.

        Implementation:

        - Update createNote() to check process.env.KSPEC_AUTHOR as default

        - Document setup in README/CLAUDE.md

        - Consider KSPEC_AUTHOR or more generic like GIT_AUTHOR_NAME fallback
      supersedes: null
    - _ulid: 01KEZM3K5W1BXE1GQSNDBB7TQE
      created_at: '2026-01-15T01:25:19.164Z'
      author: '@claude'
      content: Testing author auto-detection - this note should show git user.name
      supersedes: null
    - _ulid: 01KEZM5DWGP1AK0ZKCKRC79J92
      created_at: '2026-01-15T01:26:19.281Z'
      author: '@claude'
      content: >-
        Implemented author auto-detection:


        - Added getAuthor() helper in src/parser/yaml.ts:410-437

        - Fallback chain: KSPEC_AUTHOR env → git user.name → USER/USERNAME → undefined

        - Updated createNote() to use auto-detected author when not explicitly provided

        - Rewrote README.md with:
          - Better project intro emphasizing AI-assisted development
          - Agent Integration section with Claude Code setup instructions
          - Agent-agnostic approach using KSPEC_AUTHOR env var
          - Convention of using @ prefix for agent authors

        Approach is agent-agnostic but provides explicit Claude Code instructions. Any agent can set
        KSPEC_AUTHOR via their env configuration method.
      supersedes: null
  todos: []
- _ulid: 01KEZJNSGPTVRCMT9NHNPJ93D8
  slugs:
    - task-cli-help
  title: Implement tiered CLI help (default + full with examples)
  type: task
  spec_ref: null
  status: completed
  blocked_by: []
  closed_reason: >-
    Implemented kspec help command with extended help for all commands and concepts. Includes
    examples, descriptions, and see-also links.
  depends_on: []
  context: []
  priority: 2
  tags:
    - cli
    - dx
    - docs
  vcs_refs: []
  created_at: '2026-01-15T01:00:18.326Z'
  started_at: '2026-01-15T04:05:43.315Z'
  completed_at: '2026-01-15T04:08:36.081Z'
  notes:
    - _ulid: 01KEZJP4TRJN1QM76D8N3AWC0Z
      created_at: '2026-01-15T01:00:29.913Z'
      author: '@claude'
      content: |-
        Design: Two tiers of CLI help

        Default (--help):
        - Succinct, flags and options only
        - Quick human reference

        Extended (--help-full or 'kspec help <command>'):
        - Detailed explanations
        - Examples
        - Concept clarifications (e.g., blocked_by vs depends_on)
        - Edge cases and gotchas
        - Agent-friendly context that can be pulled into prompts

        Example for 'task unblock':

        Default:
          kspec task unblock <ref>  Unblock a task

        Extended:
          kspec task unblock <ref>
          
          Clears manual blockers and sets status to pending.
          
          Note: This clears the blocked_by field (manual string blockers),
          NOT depends_on (task references). Dependencies auto-resolve
          when referenced tasks complete.
          
          Example:
            kspec task block @my-task --reason 'Waiting on design review'
            kspec task unblock @my-task  # clears all blocked_by entries

        Implementation options:
        - Commander's .addHelpText() for extended sections
        - Separate 'kspec help <topic>' command
        - --verbose or --full flag on --help
      supersedes: null
    - _ulid: 01KEZXECCA6JM6DQH862HJGXAH
      created_at: '2026-01-15T04:08:29.835Z'
      author: '@claude'
      content: |-
        Implemented extended help system:
        - kspec help: Lists all topics (commands + concepts)
        - kspec help <topic>: Shows detailed help with examples

        Topics:
        - Commands: task, tasks, validate, session, init, setup, item
        - Concepts: refs, statuses, workflow

        Each topic includes description, examples, and 'see also' links.
        Unknown topics show error with available options.
      supersedes: null
  todos: []
- _ulid: 01KEZKE54QQJQ97TR13DZQ36EZ
  slugs:
    - task-inbox-system
  title: Design inbox/capture system for unstructured ideas
  type: spike
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 2
  tags:
    - core
    - process
  vcs_refs: []
  created_at: '2026-01-15T01:13:36.663Z'
  notes:
    - _ulid: 01KEZKEHF0CCXCGHY8FMS5XPCA
      created_at: '2026-01-15T01:13:49.281Z'
      author: '@claude'
      content: |-
        Concept: Low-friction capture space for ideas that aren't tasks yet.

        Problem:
        - Creating a task has overhead (title, slug, priority, etc.)
        - Random ideas get lost or forgotten
        - Not everything needs to be a task immediately

        Design ideas:

        Structure:
        - Simple text entries with timestamp
        - Optional tags/labels
        - Auto-generated ID
        - Maybe just: { id, text, created_at, tags? }

        Capture:
        - kspec inbox add 'random thought about X'
        - Or even: kspec idea 'random thought'
        - Minimal friction, just dump and go

        Triage (interactive):
        - kspec inbox review
        - Shows items one by one
        - Actions: promote to task, discard, defer, tag, merge

        Triage (automatic):
        - Rules-based: 'if tagged #bug, auto-create task'
        - Time-based: 'items older than 7 days, prompt for review'
        - AI-assisted: 'suggest task creation for well-formed items'

        Storage:
        - inbox.yaml or project.inbox.yaml
        - Simple flat list

        Hierarchy:
          Inbox (unstructured) → Tasks (work items) → Spec (requirements)

        Example flow:
        1. kspec inbox add 'maybe we need better error messages'
        2. Later: kspec inbox review
        3. Decide: promote to @task-error-messages or discard
      supersedes: null
  todos: []
- _ulid: 01KEZKPYY5694TA8P0KFP1FYXN
  slugs:
    - task-list-context
  title: Add context/summary to task list output
  type: task
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 2
  tags:
    - cli
    - ux
  vcs_refs: []
  created_at: '2026-01-15T01:18:25.221Z'
  notes:
    - _ulid: 01KEZKQBGPR60EW929WQ82VE3P
      created_at: '2026-01-15T01:18:38.103Z'
      author: '@claude'
      content: >-
        Problem: Task titles in 'kspec tasks ready' often lack enough context to understand what the
        task is about.


        Current output:
          01KEZKE5 (task-inbox-system) [pending] P2 Design inbox/capture system

        Options for adding context:


        1. Add 'summary' field to task schema
           - Explicit short description (one line)
           - User provides at task creation
           - Pro: intentional, curated
           - Con: more fields to manage

        2. Auto-extract first line of description
           - No schema change
           - Pro: uses existing data
           - Con: descriptions may not have good first lines

        3. Show resolved spec_ref title
           - 'implements: Validation Modes'
           - Pro: connects task to spec
           - Con: not all tasks have spec_ref

        4. Enhanced verbose mode (-v)
           - Default: current compact
           - Verbose: adds context line
           - Pro: opt-in, keeps default clean

        5. Configurable display
           - User chooses what to show
           - Pro: flexible
           - Con: complexity

        Proposed design:

        - Add optional 'summary' field to tasks (one-liner)

        - In list output, show summary if present

        - Fallback: first line of description (truncated)

        - Verbose mode shows more (spec_ref, tags, etc.)


        Example:
          01KEZKE5 (task-inbox-system) [pending] P2 Design inbox/capture system
            Low-friction capture for ideas before they become tasks
      supersedes: null
  todos: []
- _ulid: 01KEZMRBQYY2WMA44A7QAJGGN6
  slugs:
    - task-setup-cmd
  title: Implement kspec setup command for agent environment configuration
  type: task
  spec_ref: null
  status: completed
  blocked_by: []
  closed_reason: >-
    Implemented kspec setup with auto-detection for Claude Code, Cline, Aider, OpenCode, Copilot
    CLI, Gemini CLI, Codex CLI. Config installers for each agent type.
  depends_on: []
  context: []
  priority: 2
  tags:
    - dx
    - integration
  vcs_refs: []
  created_at: '2026-01-15T01:36:39.678Z'
  started_at: '2026-01-15T01:38:26.710Z'
  completed_at: '2026-01-15T01:44:01.178Z'
  notes:
    - _ulid: 01KEZMRPC9B4D43CSYVEMY5G03
      created_at: '2026-01-15T01:36:50.570Z'
      author: '@claude'
      content: |-
        Design for kspec setup command:

        Purpose: Auto-configure agent environment to work with kspec (primarily KSPEC_AUTHOR).

        Behavior:
        1. Auto-detect which agent environment we're in
        2. Install appropriate config for that environment
        3. Report success/failure

        Detection strategy:
        - Claude Code: CLAUDE_PROJECT_DIR env var present
        - Cursor: TBD (research needed)
        - VS Code + Continue: TBD
        - Aider: TBD
        - Generic/unknown: Offer shell profile or skip

        Installation targets:
        - Claude Code: ~/.claude/settings.json (merge into env.KSPEC_AUTHOR)
        - Others: TBD based on research

        Fallback:
        - If can't detect or install, print manual instructions
        - Agents using skills (e.g., @task-kspec-skill) can provide their own instructions

        Command: kspec setup
        - No subcommand needed, assumes agent context
        - Could add --dry-run flag to show what would be done
        - Could add --force to overwrite existing config

        Related: @task-kspec-skill, @task-author-env (completed)
      supersedes: null
    - _ulid: 01KEZN5K8S6XEY464Y0NTHMK1V
      created_at: '2026-01-15T01:43:53.370Z'
      author: '@claude'
      content: >-
        Implemented kspec setup command (src/cli/commands/setup.ts):


        Agent Detection (high confidence markers):

        - Claude Code: CLAUDE_PROJECT_DIR

        - Cline: CLINE_ACTIVE

        - Aider: AIDER_MODEL, AIDER_DARK_MODE

        - OpenCode: OPENCODE_CONFIG_DIR, OPENCODE_CONFIG


        Agent Detection (medium confidence):

        - GitHub Copilot CLI: COPILOT_MODEL, GH_TOKEN

        - Gemini CLI: GEMINI_API_KEY

        - Codex CLI: CODEX_SANDBOX, CODEX_HOME


        Config installers:

        - Claude Code: ~/.claude/settings.json (JSON merge)

        - Aider: ~/.aider.conf.yml (YAML append)

        - Copilot/Gemini/Codex/OpenCode: Generic JSON config

        - Cline/Roo-Code: Shell profile (manual instructions)


        Command options:

        - --dry-run: Show what would be done

        - --author: Override default author (@claude, @aider, etc.)

        - --force: Overwrite existing KSPEC_AUTHOR


        Research from subagent also found Amp (Sourcegraph) with AMP_API_KEY and
        ~/.config/amp/settings.json - could add in future.


        All tests pass. Build succeeds.
      supersedes: null
    - _ulid: 01KEZNGE5RCCV1VDBWPWXKYAKX
      created_at: '2026-01-15T01:49:48.600Z'
      author: '@claude'
      content: >-
        Fix: Updated Claude Code detection to use correct env vars.


        Original detection used CLAUDE_PROJECT_DIR which isn't always set.


        Actual env vars available in Claude Code CLI session:

        - CLAUDECODE=1 (primary detection marker)

        - CLAUDE_CODE_ENTRYPOINT=cli (indicates entry point)

        - CLAUDE_PROJECT_DIR (not always present)


        Updated detection to check all three markers. Verified working - setup now correctly detects
        and configures Claude Code.
      supersedes: null
  todos: []
- _ulid: 01KEZWDHPHN82718XXDX6VM7ZH
  slugs: []
  title: Fix broken @milestone-self-hosting references in spec
  type: task
  spec_ref: null
  status: completed
  blocked_by: []
  closed_reason: >-
    Removed 4 bogus @milestone-self-hosting dependencies from post-mvp tasks. Milestones aren't
    implemented yet, and these tasks are already properly prioritized via P2/P3 + post-mvp tags.
  depends_on: []
  context: []
  priority: 1
  tags:
    - bug
    - critical
  vcs_refs: []
  created_at: '2026-01-15T03:50:33.936Z'
  started_at: '2026-01-15T03:53:47.502Z'
  completed_at: '2026-01-15T03:54:20.726Z'
  notes:
    - _ulid: 01KEZWDT9JV9X118ETETZXN1YY
      created_at: '2026-01-15T03:50:42.739Z'
      author: '@claude'
      content: |-
        Found by kspec validate - 4 tasks reference @milestone-self-hosting which doesn't exist.

        Options:
        1. Create the milestone item in the spec
        2. Remove/update the depends_on references
        3. Replace with a different existing reference

        Run 'kspec validate --refs' to see all broken references.
      supersedes: null
  todos: []
- _ulid: 01KEZWF5GDFGJXAGXMBPJRK1KS
  slugs: []
  title: Review and fix orphaned spec items
  type: task
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 2
  tags:
    - bug
    - dx
  vcs_refs: []
  created_at: '2026-01-15T03:51:26.988Z'
  notes:
    - _ulid: 01KEZWFEMKKJFE04R5D28581KT
      created_at: '2026-01-15T03:51:36.341Z'
      author: '@claude'
      content: |-
        Found by kspec validate --orphans - 72 spec items not referenced by anything.

        These are mostly requirements nested under features. They should either:
        1. Be referenced by tasks (spec_ref) or other items
        2. Be removed if no longer relevant
        3. Have the parent feature reference them explicitly

        Run 'kspec validate --orphans -v' to see full list.

        Note: May need to improve orphan detection to handle nested items better - 
        requirements inside a feature could be considered 'referenced' implicitly.
      supersedes: null
  todos: []
- _ulid: 01KEZYBC1M3KMG9KB47CKQHY07
  slugs:
    - task-bulk-import
  title: Design bulk item import from simplified YAML
  type: spike
  spec_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 2
  tags:
    - design
    - dx
    - cli
  vcs_refs: []
  created_at: '2026-01-15T04:24:19.764Z'
  notes:
    - _ulid: 01KEZYBSKSTZS50XQ32BZA4PZP
      created_at: '2026-01-15T04:24:33.657Z'
      author: '@claude'
      content: >-
        Design idea: Bulk item import from simplified YAML


        Use case: During design sessions, quickly capture multiple related items without running
        individual CLI commands.


        Proposed format (simplified subset):

        ```yaml

        # kspec import --under @core --file design.yaml

        # or: kspec import --under @core < design.yaml


        features:
          - title: User Authentication
            slug: auth
            description: Handle user login/logout
            requirements:
              - title: Password must be hashed
                slug: password-hash
              - title: Session expires after 24h
                slug: session-expiry
            constraints:
              - title: No plaintext passwords in logs

          - title: API Rate Limiting
            slug: rate-limit
            tags: [security, api]
            requirements:
              - title: 100 requests per minute per user
        ```


        Key simplifications from full spec:

        - No ULIDs (auto-generated)

        - No status (defaults to draft/not_started)

        - Nested structure matches item relationships

        - Minimal required fields (just title)

        - Optional slug, tags, description


        Command options:

        - `kspec import --under @parent --file items.yaml`

        - `kspec import --under @parent --stdin` (pipe from editor)

        - `--dry-run` to preview what would be created

        - `--format` to output the simplified format from existing items (reverse)
      supersedes: null
    - _ulid: 01KEZYC3E9FPKNCNT8ZD957C7X
      created_at: '2026-01-15T04:24:43.723Z'
      author: '@claude'
      content: |-
        Design session workflow concept:

        1. Start a design session:
           `kspec design start --under @module-name`
           Opens $EDITOR with template, or starts interactive mode

        2. Write items in simplified format (see above)

        3. On save/exit:
           - Validates structure
           - Shows preview of items to create
           - Asks for confirmation
           - Creates all items under the parent

        Alternative: pipe from any source
           `cat design-notes.yaml | kspec import --under @core`
           `pbpaste | kspec import --under @core`  # from clipboard

        This enables rapid spec capture during brainstorming without CLI friction.
      supersedes: null
    - _ulid: 01KEZYGFD1EV5PK78Y17X3WB6K
      created_at: '2026-01-15T04:27:07.042Z'
      author: '@claude'
      content: |-
        Acceptance criteria:

        1. Clear documentation
           - Help text explains simplified format
           - Examples in 'kspec help import' / 'kspec help design'
           - Error messages guide users to correct format

        2. Skill integration
           - If @task-kspec-skill is done first: update skill output to include import command for bulk spec capture
           - If this is done first: document the format/workflow so skill can reference it

        3. Format validation
           - Validates structure before creating items
           - Clear errors for invalid nesting (e.g., constraint under constraint)
           - --dry-run shows exactly what would be created

        4. Idempotency consideration
           - Decide: error on duplicate slug? skip? update?
           - Document the behavior clearly
      supersedes: null
  todos: []
