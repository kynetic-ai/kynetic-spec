kynetic: "1.0"
project:
  name: Kynetic Spec
  version: 0.1.0
  status: draft
traits:
  - _ulid: 01KFDZSHF748JN4K9PAVM60NQ8
    slugs:
      - trait-json-output
    title: JSON Output Mode
    type: trait
    description: Commands support --json flag for structured JSON output with consistent formatting
    acceptance_criteria:
      - id: ac-1
        given: command supports JSON mode
        when: --json flag is provided
        then: output is valid JSON with no ANSI color codes
      - id: ac-2
        given: JSON mode is active
        when: command completes successfully
        then: output includes all data available in human-readable mode
      - id: ac-3
        given: JSON mode is active
        when: command encounters an error
        then: error is returned as JSON object with error field
      - id: ac-4
        given: JSON output contains references
        when: output is generated
        then: references use @ prefix consistently
      - id: ac-5
        given: JSON output contains timestamps
        when: output is generated
        then: timestamps use ISO 8601 format
      - id: ac-6
        given: command supports --json
        when: used with other formatting flags
        then: --json takes precedence over other format options
  - _ulid: 01KFDZSHFAV02EW1F6Y20MAF51
    slugs:
      - trait-multi-ref-batch
    title: Multi-Reference Batch Operations
    type: trait
    description: Commands support --refs flag to operate on multiple items in a single invocation
    acceptance_criteria:
      - id: ac-1
        given: command supports batch mode
        when: --refs @ref1 @ref2 @ref3 is provided
        then: command operates on all provided references
      - id: ac-2
        given: batch operation encounters errors
        when: processing multiple refs
        then: continue processing remaining refs and report all failures
      - id: ac-3
        given: batch operation is running
        when: all refs succeed
        then: exit code 0 is returned
      - id: ac-4
        given: batch operation is running
        when: any refs fail
        then: exit code 1 is returned
      - id: ac-5
        given: batch operation output
        when: operation completes
        then: success and failure counts are reported
      - id: ac-6
        given: --refs is provided
        when: used with positional ref argument
        then: error indicating mutually exclusive options
      - id: ac-7
        given: batch operation in JSON mode
        when: --json --refs @a @b provided
        then: output array contains result for each ref
      - id: ac-8
        given: batch operation with duplicate refs
        when: --refs @a @a @b provided
        then: each ref processed once only
  - _ulid: 01KFDZSHFANRHKH2PJGT0907PC
    slugs:
      - trait-confirmation-prompt
    title: Confirmation Prompt for Destructive Operations
    type: trait
    description: Commands prompt for confirmation before destructive operations unless --force is provided
    acceptance_criteria:
      - id: ac-1
        given: command is destructive
        when: executed without --force
        then: prompt for user confirmation before proceeding
      - id: ac-2
        given: confirmation prompt is shown
        when: user confirms (y/yes)
        then: operation proceeds
      - id: ac-3
        given: confirmation prompt is shown
        when: user declines (n/no)
        then: operation is cancelled with exit code 2
      - id: ac-4
        given: command is destructive
        when: --force flag is provided
        then: no confirmation prompt shown and operation proceeds
      - id: ac-5
        given: batch operation is destructive
        when: --refs provided without --force
        then: single confirmation covers all refs
      - id: ac-6
        given: command supports --force
        when: used in non-interactive environment
        then: operations require explicit --force flag
  - _ulid: 01KFDZSHFAP21C8TDCQ54Z1R0T
    slugs:
      - trait-filterable-list
    title: Filterable List Commands
    type: trait
    description: List commands support filtering, pagination, and sorting options
    acceptance_criteria:
      - id: ac-1
        given: list command supports filtering
        when: --status <value> provided
        then: only items with matching status shown
      - id: ac-2
        given: list command supports filtering
        when: --tag <value> provided
        then: only items with matching tag shown
      - id: ac-3
        given: list command supports pagination
        when: --limit N provided
        then: output shows at most N items
      - id: ac-4
        given: list command supports pagination
        when: --offset N provided
        then: output skips first N items
      - id: ac-5
        given: multiple filters provided
        when: --status X --tag Y used together
        then: output shows items matching all filters (AND logic)
      - id: ac-6
        given: no items match filters
        when: list command executes
        then: empty list shown with informative message
      - id: ac-7
        given: list command output
        when: results are displayed
        then: summary shows total matching items and filter state
  - _ulid: 01KFDZSHFAEN1ATTA5QKQVGCVJ
    slugs:
      - trait-priority-parameter
    title: Priority Parameter
    type: trait
    description: Commands support --priority flag with 1-5 scale where 1 is highest priority
    acceptance_criteria:
      - id: ac-1
        given: command accepts priority
        when: --priority N where 1 <= N <= 5
        then: priority is set to specified value
      - id: ac-2
        given: command accepts priority
        when: --priority N where N < 1 or N > 5
        then: error indicates valid range is 1-5
      - id: ac-3
        given: priority is displayed
        when: item is shown
        then: lower numbers shown as higher priority
      - id: ac-4
        given: priority is not specified
        when: item is created
        then: default priority applied per item type
      - id: ac-5
        given: items are sorted by priority
        when: list is displayed
        then: priority 1 items shown before priority 5
      - id: ac-6
        given: legacy priority values exist
        when: command encounters high/medium/low
        then: mapped to 1/3/5 respectively
  - _ulid: 01KFDZSHFA5KYRM58WCP6RJCQE
    slugs:
      - trait-dry-run
    title: Dry Run Preview Mode
    type: trait
    description: Commands support --dry-run flag to preview changes without applying them
    acceptance_criteria:
      - id: ac-1
        given: command supports dry run
        when: --dry-run flag is provided
        then: show what would be changed without applying
      - id: ac-2
        given: dry run mode is active
        when: command completes
        then: no files are modified
      - id: ac-3
        given: dry run mode is active
        when: output is shown
        then: clear indication that this is a preview
      - id: ac-4
        given: dry run mode is active
        when: command would error
        then: error shown but no state changed
      - id: ac-5
        given: --dry-run and --force both provided
        when: command executes
        then: dry run takes precedence (no changes made)
      - id: ac-6
        given: dry run in JSON mode
        when: --dry-run --json provided
        then: JSON output includes dry_run boolean field
  - _ulid: 01KFDZSHFATXZJ577K8Q7DSJSR
    slugs:
      - trait-semantic-exit-codes
    title: Semantic Exit Codes
    type: trait
    description: Commands use consistent exit codes to indicate different types of outcomes
    acceptance_criteria:
      - id: ac-1
        given: command completes successfully
        when: operation succeeds
        then: exit code 0
      - id: ac-2
        given: command encounters validation error
        when: user input is invalid
        then: exit code 1
      - id: ac-3
        given: command is cancelled by user
        when: confirmation prompt declined
        then: exit code 2
      - id: ac-4
        given: command encounters runtime error
        when: operation fails during execution
        then: exit code 3
      - id: ac-5
        given: command finds nothing
        when: query returns no results
        then: exit code 0 with empty result set
      - id: ac-6
        given: command used incorrectly
        when: invalid flags or arguments provided
        then: exit code 1 with usage information
      - id: ac-7
        given: batch operation completes
        when: partial failures occur
        then: exit code 1
      - id: ac-8
        given: command documentation
        when: developers implement commands
        then: exit code meanings documented in code
  - _ulid: 01KFDZSHFBEGRP3JKBHH31NYJT
    slugs:
      - trait-error-guidance
    title: Error Messages with Recovery Guidance
    type: trait
    description: Error messages include actionable suggestions for resolution
    acceptance_criteria:
      - id: ac-1
        given: command encounters error
        when: error message is shown
        then: includes description of what went wrong
      - id: ac-2
        given: command encounters error
        when: error message is shown
        then: includes suggested action to resolve
      - id: ac-3
        given: reference not found
        when: error is shown
        then: suggests checking ref with kspec search or kspec <type> list
      - id: ac-4
        given: invalid state transition
        when: error is shown
        then: indicates current state and valid next states
      - id: ac-5
        given: validation error
        when: error is shown
        then: indicates which field/value failed validation
      - id: ac-6
        given: error in JSON mode
        when: --json is active
        then: guidance included in structured error object
  - _ulid: 01KFMFAQ94G3162ZKGB2N02K3W
    slugs:
      - trait-shadow-commit
    title: Shadow Branch Auto-Commit
    type: trait
    description: Commands that modify shadow branch state automatically commit changes with semantic messages
    acceptance_criteria:
      - id: ac-1
        given: command modifies state in shadow worktree
        when: save operation completes successfully
        then: git commit is created in shadow branch with semantic message
      - id: ac-2
        given: shadow commit is created
        when: commit message is generated
        then: message follows pattern operation-colon-ref-short with optional detail
      - id: ac-3
        given: shadow commit is created
        when: item reference is available
        then: commit message includes ULID prefix (8 chars) or primary slug
      - id: ac-4
        given: shadow is not configured (no worktree)
        when: command that would normally commit runs
        then: command completes successfully without attempting git operations
      - id: ac-5
        given: save operation fails
        when: validation or IO error occurs
        then: no commit is attempted and error is returned
      - id: ac-6
        given: shadow has remote configured
        when: commit succeeds
        then: push is attempted in fire-and-forget mode (failure doesn't block command)
      - id: ac-7
        given: commit or push fails
        when: save succeeded but git operation failed
        then: command succeeds but outputs warning about sync state
      - id: ac-8
        given: command performs multiple related saves
        when: all saves complete successfully
        then: single atomic commit covers all changes
  - _ulid: 01KFMKZFTXSK4QFH74GQ461G9A
    slugs:
      - trait-websocket-protocol
    title: WebSocket Protocol Patterns
    type: trait
    description: WebSocket connection patterns including lifecycle management, topic-based pub/sub,
      heartbeat ping/pong, sequence tracking for deduplication, and backpressure handling. Based on
      proven patterns from kynetic project.
    acceptance_criteria:
      - id: ac-1
        given: WebSocket connection is established
        when: client connects
        then: server assigns unique connection ID and sends connected event with session_id
      - id: ac-2
        given: client wants notifications
        when: subscribe command sent with topics array
        then: server tracks subscription and sends ack with request_id
      - id: ac-3
        given: client is subscribed to topic
        when: relevant change occurs
        then: server broadcasts event with format {msg_id, seq, timestamp, topic, event, data}
      - id: ac-4
        given: WebSocket connection is active
        when: 30 seconds pass without activity
        then: server sends ping frame
      - id: ac-5
        given: ping was sent
        when: no pong received within 90 seconds
        then: connection is closed with code 1001
      - id: ac-6
        given: server sends events
        when: client cannot keep up (backpressure)
        then: server pauses non-critical broadcasts until drain event
      - id: ac-7
        given: connection is closing
        when: close initiated
        then: use code 1000 for clean close, 1001 for timeout, 1011 for error
      - id: ac-8
        given: client reconnects after disconnect
        when: new connection established
        then: client resets sequence tracking (lastSeqProcessed = -1) since server generates new sequence
  - _ulid: 01KFMKZFTYTRK4ENHFKWGR5RF6
    slugs:
      - trait-api-endpoint
    title: REST API Endpoint Patterns
    type: trait
    description: Consistent patterns for REST API endpoints including response format, error handling,
      pagination, and request validation
    acceptance_criteria:
      - id: ac-1
        given: API endpoint receives valid request
        when: processing succeeds
        then: returns 2xx status with JSON body
      - id: ac-2
        given: API endpoint receives invalid ref
        when: ref not found
        then: returns 404 with {error, message, suggestion} including similar refs if available
      - id: ac-3
        given: API endpoint receives invalid body
        when: validation fails
        then: returns 400 with {error, details:[{field, message}]} array
      - id: ac-4
        given: list endpoint is called
        when: pagination supported
        then: accepts limit and offset query params, returns {items, total, offset, limit} wrapper
      - id: ac-5
        given: API endpoint mutates state
        when: change persists
        then: shadow commit occurs with semantic message
      - id: ac-6
        given: API request is processed
        when: response generated
        then: includes X-Request-Id header for tracing
  - _ulid: 01KFMKZFTYKPEXCHSAK9MTZX5Z
    slugs:
      - trait-localhost-security
    title: Localhost-Only Security
    type: trait
    description: Security pattern for services that bind only to localhost, providing authentication
      through network isolation
    acceptance_criteria:
      - id: ac-1
        given: server is starting
        when: binding to network interface
        then: only accepts connections from 127.0.0.1 and ::1 (IPv6 localhost)
      - id: ac-2
        given: connection attempt from non-localhost
        when: request received
        then: connection rejected with 403 Forbidden
      - id: ac-3
        given: server is configured
        when: configuration allows external binding
        then: warning displayed about security implications
  - _ulid: 01KFMXM08H4GK6328W515RBQAJ
    slugs:
      - trait-retrospective
    title: Retrospective Verification
    type: trait
    tags: []
    description: "Applied to specs describing already-implemented functionality where implementation
      predates formal task tracking. Common scenarios: bootstrap specs, legacy adoption,
      reverse-engineered specs from existing code. Specs with this trait: do not require linked
      implementation tasks, must have verified_at and verified_by fields, status is manually set
      rather than derived from task completion."
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    traits: []
    notes: []
    created: 2026-01-23T07:55:37.105Z
    acceptance_criteria:
      - id: ac-1
        given: a spec item uses @trait-retrospective
        when: validation runs alignment checks
        then: no 'orphaned spec' warning is generated for missing tasks
      - id: ac-2
        given: a spec uses @trait-retrospective
        when: status is set to implemented or verified
        then: verified_at (ISO timestamp) and verified_by (agent ref) are required
      - id: ac-3
        given: a spec uses @trait-retrospective without verified_at/verified_by
        when: validation runs
        then: warning indicates missing verification metadata
      - id: ac-4
        given: a retrospective spec exists
        when: viewing item details (kspec item get)
        then: output indicates retrospective verification source
includes:
  - modules/core.yaml
  - modules/schema.yaml
  - modules/tasks.yaml
  - modules/cli.yaml
  - modules/meta.yaml
  - modules/shadow.yaml
  - modules/web-ui.yaml
