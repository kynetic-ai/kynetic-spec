_ulid: 01KEZCJPHVBKRZQ7VVBF84H51Z
slugs:
  - cli
  - cli-module
title: CLI Interface
type: module
status:
  maturity: draft
  implementation: not_started
description: |
  The kspec CLI is the primary interface to Kynetic Spec.
  Follows git's plumbing/porcelain model: low-level primitives
  for scripts/agents, high-level commands for humans.
features:
  - _ulid: 01KEZCJPHW3CSMXYZT01FP76BM
    slugs:
      - cli-design
    title: CLI Design Principles
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      The CLI is designed for both human and agent use.
      Consistent structure, predictable output, clear errors.
    requirements:
      - _ulid: 01KEZCJPHWP32HK8MR38P2WSSJ
        slugs:
          - cli-structure
        title: Command Structure
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          Commands follow consistent structure:

          kspec <resource> <action> [args] [flags]

          Resources: item, task, link, todo, etc.
          Actions: add, get, list, set, delete, etc.

          Examples:
          - kspec item add --type feature --title "Login"
          - kspec task start @impl-login
          - kspec tasks ready
        implements:
          - '@cli-design'
      - _ulid: 01KEZCJPHWKVBFSAEP0MMH57DQ
        slugs:
          - cli-json-output
        title: JSON Output Mode
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          All commands support --json flag for structured output:

          kspec tasks ready --json
          kspec item get @login --json

          JSON output includes:
          - success: boolean
          - data: The result
          - errors: Array of error objects (if any)
        implements:
          - '@cli-design'
      - _ulid: 01KEZCJPHWB81SAWT4ZGCV75FC
        slugs:
          - cli-exit-codes
        title: Semantic Exit Codes
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          Exit codes are semantic, not just 0/1:

          - 0: Success
          - 1: General error
          - 2: Usage error (bad arguments)
          - 3: Not found
          - 4: Validation failed
          - 5: Conflict (already exists, etc.)

          Scripts can handle specific cases.
        implements:
          - '@cli-design'
      - _ulid: 01KEZCJPHWBEEP2BYRP6YVNK9F
        slugs:
          - cli-agent-features
        title: Agent-Friendly Features
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          Features for agent/script usage:

          - --json: Structured output
          - --no-prompt: Never prompt (KSPEC_NO_PROMPT=1)
          - --dry-run: Show what would happen
          - --if-not-exists: Idempotent creation
          - --quiet: Suppress non-essential output

          Agents should be able to use kspec without interaction.
        implements:
          - '@cli-design'
  - _ulid: 01KEZCJPHXV1SK9BY02J6GK719
    slugs:
      - item-commands
    title: Item Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      CRUD operations for spec items.
      The foundation of CLI functionality.
    acceptance_criteria:
      - id: ac-item-cmd-1
        given: valid item data
        when: kspec item add runs
        then: item is created with auto-generated ULID
      - id: ac-item-cmd-2
        given: an existing item @login
        when: kspec item get @login runs
        then: full item data is displayed
    requirements:
      - _ulid: 01KEZCJPHXGMME0BZ5C65R5QH8
        slugs:
          - item-add
        title: kspec item add
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec item add [options]

          Options:
          - --type <type>: Item type (feature, requirement, etc.)
          - --title <title>: Required title
          - --slug <slug>: Optional slug (auto-generated if not provided)
          - --field key=value: Set additional fields
          - --parent <ref>: Nest under parent item

          Returns created item (with generated ULID).
        implements:
          - '@item-commands'
      - _ulid: 01KEZCJPHXKYVVP0YWF261A8N3
        slugs:
          - item-get
        title: kspec item get
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |
          kspec item get <ref> [options]

          Options:
          - --field <path>: Get specific field only
          - --format <fmt>: Output format (yaml, json)

          Resolves @reference, displays full item.
        implements:
          - '@item-commands'
        acceptance_criteria:
          - id: ac-1
            given: a spec item @login has acceptance criteria
            when: kspec item get @login runs
            then: acceptance criteria are displayed in the output
          - id: ac-2
            given: a valid reference @login exists
            when: kspec item get @login runs
            then: displays item title, ULID, slugs, type, status, and description
          - id: ac-3
            given: reference @nonexistent does not exist
            when: kspec item get @nonexistent runs
            then: exits with error and helpful message
      - _ulid: 01KEZCJPHXT212CZV6W64YJFAQ
        slugs:
          - item-list
        title: kspec item list
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec item list [filters]

          Filters:
          - --type <type>: By item type
          - --status <status>: By maturity/implementation
          - --tag <tag>: By tag
          - --has-field <field>: Items with field present

          Returns list of matching items.
        implements:
          - '@item-commands'
      - _ulid: 01KEZCJPHX678F01J6TZE5SX1Q
        slugs:
          - item-set
        title: kspec item set
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |-
          kspec item set <ref> [options]

          Update a spec item's fields.

          Options:
          - --title <title>: Set item title
          - --type <type>: Set item type
          - --slug <slug>: Add a slug (can have multiple)
          - --remove-slug <slug>: Remove a slug
          - --priority <priority>: Set priority
          - --tag <tag...>: Set tags (replaces existing)
          - --description <desc>: Set description
          - --status <status>: Set implementation status
          - --maturity <maturity>: Set maturity level

          Updates item in place and auto-commits to shadow branch.
        implements:
          - '@item-commands'
        acceptance_criteria:
          - id: ac-1
            given: item @my-item exists with slugs ['original']
            when: kspec item set @my-item --slug new-slug runs
            then: item now has slugs ['original', 'new-slug']
          - id: ac-2
            given: item @my-item exists with slugs ['keep', 'remove']
            when: kspec item set @my-item --remove-slug remove runs
            then: item now has slugs ['keep']
          - id: ac-3
            given: item @my-item has only one slug 'only-one'
            when: kspec item set @my-item --remove-slug only-one runs
            then: 'error: cannot remove last slug'
          - id: ac-4
            given: item @my-item exists
            when: kspec item set @my-item --status implemented runs
            then: item's implementation status is updated to 'implemented'
      - _ulid: 01KEZCJPHXH5SAZ7NWESVKWS3Y
        slugs:
          - item-delete
        title: kspec item delete
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec item delete <ref> [options]

          Options:
          - --force: Skip confirmation
          - --cascade: Delete children too

          Warns if item has references. Consider deprecation instead.
        implements:
          - '@item-commands'
      - _ulid: 01KF374D6206HGMP55HGE8VNAQ
        slugs:
          - item-ac
        title: kspec item ac
        type: requirement
        tags: []
        description: |-
          kspec item ac <subcommand>

          Subcommands:
          - add <ref> --given '...' --when '...' --then '...': Add acceptance criterion
          - list <ref>: List acceptance criteria for an item
          - set <ref> <ac-id> [options]: Update an acceptance criterion
          - remove <ref> <ac-id> [--force]: Remove an acceptance criterion

          Manages acceptance criteria on spec items via CLI.
          Handles proper YAML escaping to prevent formatting errors.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        acceptance_criteria:
          - id: ac-item-ac-add
            given: a spec item exists
            when: kspec item ac add @ref --given "precondition" --when "action" --then "outcome" runs
            then: >-
              AC is added with auto-generated ID; outputs "OK Added acceptance criterion: ac-N to
              @ref"
          - id: ac-item-ac-add-id
            given: a spec item exists
            when: kspec item ac add @ref --id custom-id --given "..." --when "..." --then "..." runs
            then: AC is added with the specified ID
          - id: ac-item-ac-add-dup
            given: a spec item with AC id "ac-1" exists
            when: kspec item ac add @ref --id ac-1 --given "..." --when "..." --then "..." runs
            then: exits code 3; error "Acceptance criterion ac-1 already exists"
          - id: ac-item-ac-add-task
            given: a task exists (not a spec item)
            when: kspec item ac add @task-ref --given "..." --when "..." --then "..." runs
            then: exits code 3; error "Tasks don't have acceptance criteria"
          - id: ac-item-ac-list
            given: a spec item with acceptance criteria
            when: kspec item ac list @ref runs
            then: displays all AC in Given/When/Then format with IDs
          - id: ac-item-ac-list-empty
            given: a spec item without acceptance criteria
            when: kspec item ac list @ref runs
            then: displays "No acceptance criteria"
          - id: ac-item-ac-set
            given: a spec item with AC id "ac-1"
            when: kspec item ac set @ref ac-1 --then "new outcome" runs
            then: >-
              AC then field is updated; outputs "OK Updated acceptance criterion: ac-1 on @ref
              (then)"
          - id: ac-item-ac-set-notfound
            given: a spec item without AC id "ac-99"
            when: kspec item ac set @ref ac-99 --then "..." runs
            then: exits code 3; error "Acceptance criterion ac-99 not found"
          - id: ac-item-ac-remove
            given: a spec item with AC id "ac-1"
            when: kspec item ac remove @ref ac-1 --force runs
            then: 'AC is removed; outputs "OK Removed acceptance criterion: ac-1 from @ref"'
          - id: ac-item-ac-remove-confirm
            given: a spec item with AC id "ac-1"
            when: kspec item ac remove @ref ac-1 runs (no --force)
            then: prompts for confirmation before removing
        created: '2026-01-16T10:55:32.034Z'
        status:
          maturity: draft
          implementation: implemented
      - _ulid: 01KF3E3QPARGX5QWJMT231DCC5
        slugs:
          - item-patch
        title: kspec item patch
        type: requirement
        tags:
          - cli
          - dx
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T12:57:30.058Z'
        description: |-
          kspec item patch <ref> [options]

          Update spec item with JSON data.

          Options:
          - --data <json>: JSON object with fields to update
          - --dry-run: Show what would change without writing
          - --allow-unknown: Allow unknown fields (for extending format)

          Accepts stdin if no --data provided:
            echo '{"status": {"implementation": "implemented"}}' | kspec item patch @my-item

          Validates input against SpecItemInputSchema (strict by default).
        acceptance_criteria:
          - id: ac-1
            given: valid JSON with status field
            when: kspec item patch @my-item --data '{"status":{"implementation":"implemented"}}' runs
            then: item status is updated to implemented
          - id: ac-2
            given: invalid JSON syntax
            when: kspec item patch @my-item --data 'not json' runs
            then: error with helpful JSON parse message
          - id: ac-3
            given: JSON piped via stdin
            when: echo '{"title":"New"}' | kspec item patch @my-item runs
            then: stdin JSON is used for update
          - id: ac-4
            given: '--dry-run flag provided'
            when: kspec item patch @my-item --data '{"title":"New"}' --dry-run runs
            then: shows what would change without writing
          - id: ac-5
            given: JSON with unknown field 'foobar'
            when: kspec item patch @my-item --data '{"foobar":"value"}' runs
            then: error about unknown field
          - id: ac-6
            given: JSON with unknown field and --allow-unknown flag
            when: kspec item patch @my-item --data '{"foobar":"value"}' --allow-unknown runs
            then: field is written to item
  - _ulid: 01JHNKA8W6CTSK000000000000
    slugs:
      - task-commands
    title: Task Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      Commands for task lifecycle management.
      State transitions, queries, notes, todos.
    requirements:
      - _ulid: 01JHNKA8W7CTSK100000000000
        slugs:
          - task-add
        title: kspec task add
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task add [options]

          Options:
          - --title <title>: Task title
          - --type <type>: task, epic, bug, spike, infra
          - --spec-ref <ref>: Link to spec item
          - --depends-on <refs>: Dependencies
          - --priority <n>: Priority (1-5)

          Creates task in pending status.
        implements:
          - '@task-commands'
      - _ulid: 01JHNKA8W8CTSK200000000000
        slugs:
          - task-start
        title: kspec task start
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task start <ref>

          Transitions task from pending to in_progress.
          Sets started_at timestamp.
          Fails if task is blocked or already in_progress.
        implements:
          - '@task-commands'
        depends_on:
          - '@state-in-progress'
      - _ulid: 01JHNKA8W9CTSK300000000000
        slugs:
          - task-complete
        title: kspec task complete
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task complete <ref> [options]

          Options:
          - --reason <text>: Completion note

          Transitions task to completed status.
          Sets completed_at timestamp.
        implements:
          - '@task-commands'
        depends_on:
          - '@state-completed'
      - _ulid: 01JHNKA9W0CTSK400000000000
        slugs:
          - task-block
        title: kspec task block
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task block <ref> [options]

          Options:
          - --reason <text>: Required blocker description

          Transitions task to blocked status.
          Adds reason to blocked_by array.
        implements:
          - '@task-commands'
        depends_on:
          - '@state-blocked'
      - _ulid: 01JHNKA9W1CTSK500000000000
        slugs:
          - task-unblock
        title: kspec task unblock
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task unblock <ref>

          Transitions task from blocked back to in_progress (or pending).
          Clears blocked_by array.
        implements:
          - '@task-commands'
      - _ulid: 01JHNKA9W2CTSK600000000000
        slugs:
          - task-cancel
        title: kspec task cancel
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec task cancel <ref> [options]

          Options:
          - --reason <text>: Why cancelled

          Transitions task to cancelled status.
          Terminal state.
        implements:
          - '@task-commands'
        depends_on:
          - '@state-cancelled'
      - _ulid: 01KF0VJEHSCEQ5SVD6XRYV81M1
        slugs:
          - cmd-task-delete
        title: kspec task delete
        type: requirement
        tags: []
        description: |-
          kspec task delete <ref> [options]

          Options:
          - --force: Skip confirmation
          - --dry-run: Show what would be deleted

          Removes task from source file. Confirmation required unless --force.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-15T12:55:00.409Z'
        status:
          maturity: draft
          implementation: implemented
      - _ulid: 01KF24HMZXS5XZM7K109MRMEP3
        slugs:
          - task-set
        title: kspec task set
        type: requirement
        tags: []
        description: |-
          kspec task set <ref> [options]

          Options:
          - --title <title>: Update task title
          - --spec-ref <ref>: Link to spec item
          - --depends-on <refs>: Set dependencies (replaces existing)
          - --priority <n>: Set priority (1-5)
          - --slug <slug>: Add a slug alias
          - --tag <tag>: Add a tag (repeatable)

          Modifies task fields without changing state.
          Use for linking tasks to specs, adjusting priority, etc.
        acceptance_criteria:
          - id: ac-task-set-1
            given: a task exists
            when: kspec task set @task --title 'New Title' runs
            then: 'task title is updated; outputs "OK Updated task: <ref> (title)"'
          - id: ac-task-set-2
            given: a task and spec item exist
            when: kspec task set @task --spec-ref @spec-item runs
            then: task spec_ref is set; outputs confirmation with (spec_ref)
          - id: ac-task-set-3
            given: a task exists
            when: kspec task set @task --spec-ref @nonexistent runs
            then: exits code 3; error "Spec reference not found"
          - id: ac-task-set-4
            given: two tasks exist
            when: kspec task set @task1 --spec-ref @task2 runs
            then: exits code 3; error "is a task, not a spec item"
          - id: ac-task-set-5
            given: a task exists
            when: kspec task set @task --priority 3 runs
            then: task priority is updated to 3
          - id: ac-task-set-6
            given: a task exists
            when: kspec task set @task --priority 6 runs
            then: exits code 3; error "Priority must be between 1 and 5"
          - id: ac-task-set-7
            given: a task exists
            when: kspec task set @task runs with no options
            then: warns "No changes specified"; no changes saved
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:05.853Z'
        status:
          maturity: draft
          implementation: implemented
      - _ulid: 01KF24J220BKK8X3QA86N59E4X
        slugs:
          - task-get
        title: kspec task get
        type: requirement
        tags: []
        description: |-
          kspec task get <ref>

          Displays task details including:
          - Status and timestamps
          - Spec reference if linked
          - Dependencies and blockers
          - Recent notes summary

          Primary command for inspecting individual tasks.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:19.234Z'
        status:
          implementation: implemented
      - _ulid: 01KF24J46CY5Y7MPN1PXZT2GRB
        slugs:
          - task-note
        title: kspec task note
        type: requirement
        tags: []
        description: |-
          kspec task note <ref> <message>

          Options:
          - --author <ref>: Note author (default: @claude or @user)

          Appends a timestamped note to the task's notes array.
          Notes are append-only and track work progress.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:21.422Z'
        status:
          implementation: implemented
      - _ulid: 01KF24J6HENWZ8KS5ZHQHCMA9B
        slugs:
          - task-notes-cmd
        title: kspec task notes
        type: requirement
        tags: []
        description: |-
          kspec task notes <ref>

          Displays all notes for a task in chronological order.
          Shows timestamp, author, and content for each note.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:23.823Z'
        status:
          implementation: implemented
      - _ulid: 01KF24J8KKT3Y1N6M6JR7ACHQ8
        slugs:
          - task-todos-cmd
        title: kspec task todos
        type: requirement
        tags: []
        description: |-
          kspec task todos <ref>

          Displays all todos for a task.
          Shows status (pending/done), text, and completion info.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:25.939Z'
        status:
          implementation: implemented
      - _ulid: 01KF24JAEM65BGJ5ZK0QM4XQNN
        slugs:
          - task-todo
        title: kspec task todo
        type: requirement
        tags: []
        description: |-
          kspec task todo <subcommand>

          Subcommands:
          - add <ref> <text>: Add a todo to a task
          - done <ref> <index>: Mark a todo as done
          - remove <ref> <index>: Remove a todo

          Lightweight checklist items within a task.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T00:51:27.829Z'
        status:
          implementation: implemented
      - _ulid: 01KF3E3S2Y8PZ1E75G202DG2JR
        slugs:
          - task-patch
        title: kspec task patch
        type: requirement
        tags:
          - cli
          - dx
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T12:57:31.487Z'
        description: |-
          kspec task patch <ref> [options]

          Update task with JSON data.

          Options:
          - --data <json>: JSON object with fields to update
          - --dry-run: Show what would change without writing
          - --allow-unknown: Allow unknown fields (for extending format)

          Accepts stdin if no --data provided.
          Validates input against TaskInputSchema (strict by default).
        acceptance_criteria:
          - id: ac-1
            given: valid JSON with priority field
            when: kspec task patch @my-task --data '{"priority":1}' runs
            then: task priority is updated
          - id: ac-2
            given: invalid JSON syntax
            when: kspec task patch @my-task --data 'bad' runs
            then: error with helpful message
          - id: ac-3
            given: JSON with unknown field
            when: kspec task patch @my-task --data '{"unknown":true}' runs
            then: error about unknown field (strict by default)
          - id: ac-4
            given: '--allow-unknown flag and unknown field'
            when: kspec task patch @my-task --data '{"unknown":true}' --allow-unknown runs
            then: field is written
  - _ulid: 01JHNKA9W3CQRY000000000000
    slugs:
      - query-commands
    title: Query Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      Commands for querying spec and task data.
      The primary interface for understanding what exists and what's ready.
    requirements:
      - _ulid: 01JHNKA9W4CQRY100000000000
        slugs:
          - cmd-tasks-ready
        title: kspec tasks ready
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec tasks ready [options]

          Returns all tasks that are ready to work on:
          - status = pending
          - all depends_on completed
          - no blocked_by entries

          THE primary command for agents and humans.
        implements:
          - '@query-commands'
          - '@query-ready'
      - _ulid: 01JHNKA9W5CQRY200000000000
        slugs:
          - cmd-tasks-next
        title: kspec tasks next
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec tasks next

          Returns single highest-priority ready task.
          Useful for "give me something to do" workflow.
        implements:
          - '@query-commands'
          - '@query-next'
      - _ulid: 01JHNKA9W6CQRY300000000000
        slugs:
          - cmd-tasks-list
        title: kspec tasks list
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec tasks list [filters]

          General task listing with filters.
          See @query-filters for filter options.
        implements:
          - '@query-commands'
      - _ulid: 01JHNKA9W7CQRY400000000000
        slugs:
          - cmd-tasks-blocked
        title: kspec tasks blocked
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec tasks blocked

          Returns all blocked tasks with their blockers.
          Useful for identifying what's stuck.
        implements:
          - '@query-commands'
  - _ulid: 01KEZCJPHX1XC0F94K2HJ2F99X
    slugs:
      - link-commands
    title: Link Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: medium
    tags:
      - cli
    description: |
      Commands for managing relationships between items.
      Create, query, and remove links.
    requirements:
      - _ulid: 01KEZCJPHXWK4N7K72F0CFWBGN
        slugs:
          - link-create
        title: kspec link create
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec link create <from> <to> [options]

          Options:
          - --type <type>: Relationship type (depends_on, implements, etc.)

          Creates relationship from source to target.
          Updates the source item's relationship array.
        implements:
          - '@link-commands'
      - _ulid: 01KEZCJPHY64RH5PPE6WJSPH03
        slugs:
          - link-list
        title: kspec link list
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec link list [options]

          Options:
          - --from <ref>: Links from this item
          - --to <ref>: Links to this item
          - --type <type>: Filter by relationship type

          Shows relationships matching filters.
        implements:
          - '@link-commands'
      - _ulid: 01KEZCJPHYBD2BSED0D9ZHRMGQ
        slugs:
          - link-delete
        title: kspec link delete
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec link delete <from> <to> [options]

          Options:
          - --type <type>: Specific relationship type to remove

          Removes relationship. Updates source item.
        implements:
          - '@link-commands'
  - _ulid: 01KEZCJPHYBMBBKESVKBBV4CGM
    slugs:
      - validate-commands
    title: Validation Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      Commands for validating spec and task integrity.
      Essential for CI and pre-commit checks.
    requirements:
      - _ulid: 01KEZCJPHYHN29QV8C088GVGD1
        slugs:
          - cmd-validate
        title: kspec validate
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |-
          kspec validate [options]

          Options:
          - --schema: Check schema conformance only
          - --refs: Check all @references resolve
          - --orphans: Find unreferenced items
          - --task-refs: Check task spec_refs resolve
          - --fix: Auto-fix issues where possible (invalid ULIDs, missing timestamps)
          - --strict: Treat warnings as errors

          Default: All checks. Returns errors and warnings.

          Auto-fix behavior (--fix):
          - Invalid ULIDs: Regenerates with valid ULID
          - Missing timestamps: Adds created field if neither created nor created_at exists
          - Excludes test fixtures from auto-fixing
          - Re-validates after fixes to confirm resolution
        implements:
          - '@validate-commands'
          - '@validation-modes'
      - _ulid: 01KEZCJPHYVBG79TSAVC1KB0SZ
        slugs:
          - cmd-lint
        title: kspec lint
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec lint [options]

          Options:
          - --fix: Auto-fix what's possible
          - --strict: Exit non-zero on warnings

          Combines validation with style checks.
          Good for CI: kspec lint --strict
        implements:
          - '@validate-commands'
  - _ulid: 01JHNKAA05CDRV000000000000
    slugs:
      - derive-commands
    title: Derive Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      Commands for deriving tasks from spec items.
      Explicit, on-demand task creation.
    requirements:
      - _ulid: 01JHNKAA06CDRV100000000000
        slugs:
          - cmd-derive
        title: kspec derive
        type: requirement
        status:
          maturity: draft
          implementation: in_progress
        description: |
          kspec derive <ref> [options]
          kspec derive --all [options]

          Derives implementation tasks from spec items.

          Behavior:
          - Recursively creates tasks for item and all children
          - Features create feature tasks
          - Requirements create requirement tasks under feature
          - Auto-sets depends_on based on spec hierarchy:
            - Requirement tasks depend on parent feature task
            - Child features depend on parent module task
          - Skips items that already have tasks (unless --force)

          Options:
          - --recursive: Derive for item and all children (default)
          - --flat: Only derive for the specified item, no children
          - --force: Create even if task exists
          - --dry-run: Show what would be created
          - --json: Output created tasks as JSON

          Examples:
            kspec derive @shadow-branch
            # Creates tasks for module + all features + all requirements
            # with proper depends_on relationships

            kspec derive @shadow-concept --flat
            # Creates single task for just that feature

          Idempotent by default.
        implements:
          - '@derive-commands'
          - '@derive-command'
  - _ulid: 01KEZCJPHYV1GH5KP8T0VSXWWS
    slugs:
      - init-commands
    title: Init and Config Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - mvp
      - cli
    description: |
      Commands for initializing and configuring kspec.
      Project setup and configuration management.
    requirements:
      - _ulid: 01KEZCJPHYDTPQ34W8FRXQ9GKX
        slugs:
          - cmd-init
        title: kspec init
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec init [options]

          Options:
          - --name <name>: Project name
          - --single-file: Create kynetic.yaml only (vs directory)

          Creates initial spec structure:
          - spec/kynetic.yaml (manifest)
          - spec/modules/ (if not --single-file)

          Interactive prompts unless --no-prompt.
        implements:
          - '@init-commands'
      - _ulid: 01KEZCJPHYZKAW6006AM7P5KWT
        slugs:
          - cmd-hooks
        title: kspec hooks
        type: requirement
        status:
          maturity: draft
          implementation: not_started
        description: |
          kspec hooks install     # Install configured hooks
          kspec hooks uninstall   # Remove hooks
          kspec hooks list        # Show configured hooks

          Reads hooks from manifest config section.
          Sets up git hooks for validation.
        implements:
          - '@init-commands'
      - _ulid: 01KF14PTK6XWQPE0ZG32WMVJRK
        slugs:
          - cmd-setup
        title: kspec setup
        type: requirement
        tags:
          - mvp
          - cli
        description: >-
          kspec setup [options]


          Configures agent environment for kspec. Auto-detects the running agent and installs
          appropriate configuration.


          Agent Detection:

          - claude-code (via CLAUDECODE, CLAUDE_CODE_ENTRYPOINT, etc.)

          - aider (via AIDER_* env vars)

          - cline/roo-code (VS Code extensions)

          - copilot-cli, gemini-cli, codex-cli, opencode, amp


          Actions:

          - Sets KSPEC_AUTHOR in agent config file (e.g., ~/.claude/settings.json)

          - For Claude Code: installs hooks to .claude/settings.json (project-level):
            - UserPromptSubmit: spec-first reminder (session prompt-check)
            - Stop: session checkpoint for uncommitted work
          - Prints manual instructions for agents without config file support


          Options:

          - --dry-run: Show what would be done without making changes

          - --author <author>: Custom author string (default: auto-detected like @claude, @aider)

          - --no-hooks: Skip installing Claude Code hooks

          - --force: Overwrite existing configuration


          Exit codes follow @cli-exit-codes.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-15T15:34:40.999Z'
        status:
          implementation: implemented
      - _ulid: 01KF3ECD4PQ01ENY5PVSPTKK9X
        slugs:
          - cmd-module-add
        title: kspec module add
        type: requirement
        tags:
          - cli
          - dx
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T13:02:14.166Z'
        description: |-
          kspec module add [options]

          Create a new module YAML file.

          Options:
          - --title <title>: Module title (required)
          - --slug <slug>: Module slug (required, becomes filename)
          - --description <desc>: Module description
          - --tag <tag...>: Tags for the module

          Creates:
          1. modules/{slug}.yaml with module item
          2. Adds include to manifest

          Example:
            kspec module add --title "Auth System" --slug auth
            # Creates modules/auth.yaml
            # Adds to manifest: includes: - modules/auth.yaml
        acceptance_criteria:
          - id: ac-1
            given: valid title and slug provided
            when: kspec module add --title 'Auth' --slug auth runs
            then: modules/auth.yaml created with module item structure
          - id: ac-2
            given: module created successfully
            when: module add completes
            then: manifest includes array has new entry for module file
          - id: ac-3
            given: slug 'auth' already exists in spec
            when: kspec module add --title 'Another' --slug auth runs
            then: error about duplicate slug
          - id: ac-4
            given: shadow branch is enabled
            when: module is created
            then: changes are auto-committed to shadow branch
  - _ulid: 01KF15N59C28PGQYJQNADVFHPA
    slugs:
      - inbox-commands
    title: Inbox Commands
    type: feature
    status:
      maturity: draft
      implementation: not_started
    priority: high
    tags:
      - cli
      - process
    description: |
      Low-friction capture for ideas that aren't tasks yet.
      Inbox items are simple text entries that can be triaged later.
      Storage: project.inbox.yaml (separate file for clean schema).
    requirements:
      - _ulid: 01KF15N59ESD55YP3PP8EW96AJ
        slugs:
          - cmd-inbox-add
        title: kspec inbox add
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |
          kspec inbox add <text> [options]

          Options:
          - --tag <tag>: Add tag(s) for categorization (repeatable)

          Quick capture with minimal friction.
          Auto-generates ULID, timestamp, and added_by (from KSPEC_AUTHOR or git).

          Examples:
          - kspec inbox add "maybe we need better error messages"
          - kspec inbox add "refactor auth flow" --tag auth --tag refactor
        implements:
          - '@inbox-commands'
      - _ulid: 01KF15N59E5B55QEM6KVJHGSN5
        slugs:
          - cmd-inbox-list
        title: kspec inbox list
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |
          kspec inbox list [options]

          Options:
          - --tag <tag>: Filter by tag
          - --limit <n>: Limit results
          - --oldest: Sort oldest first (default for triage)

          Shows inbox items. Default sort is oldest first to
          encourage dealing with older items.
        implements:
          - '@inbox-commands'
      - _ulid: 01KF15N59E6WMGPHZ8END163G6
        slugs:
          - cmd-inbox-promote
        title: kspec inbox promote
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |
          kspec inbox promote <ref> [options]

          Options:
          - --title <title>: Task title (prompts if not provided)
          - --priority <n>: Priority (1-5)
          - --spec-ref <ref>: Link to spec item
          - --type <type>: Task type (task, bug, spike, etc.)
          - --tag <tag>: Add tag(s) to task

          Converts inbox item to task. Prompts for required fields
          if not provided via options. Deletes inbox item after
          successful task creation.

          Examples:
          - kspec inbox promote @01KF0... (interactive)
          - kspec inbox promote @01KF0... --title "Improve errors" --priority 2
        implements:
          - '@inbox-commands'
      - _ulid: 01KF15N59ER8D2XAGND1003ZSH
        slugs:
          - cmd-inbox-delete
        title: kspec inbox delete
        type: requirement
        status:
          maturity: draft
          implementation: implemented
        description: |
          kspec inbox delete <ref> [options]

          Options:
          - --force: Skip confirmation

          Removes inbox item. Use when idea is no longer relevant.
        implements:
          - '@inbox-commands'
  - _ulid: 01KF1A8NP424N6FAY64C7T49R2
    slugs:
      - fuzzy-matching
    title: Fuzzy Matching
    type: feature
    priority: medium
    tags:
      - dx
      - cli
    description: >-
      Infrastructure for fuzzy string matching across kspec. Enables approximate matching for
      item/task search and CLI command suggestions. Uses Levenshtein distance or similar algorithm
      for scoring matches.
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    created: '2026-01-15T17:11:48.677Z'
    requirements:
      - _ulid: 01KF1A8Z6VHV4TKGS9GNZHSDZA
        slugs:
          - fuzzy-item-search
        title: Fuzzy Item and Task Search
        type: requirement
        tags:
          - dx
          - search
        description: >-
          kspec item list --fuzzy <query>

          kspec tasks list --fuzzy <query>


          Enables searching for items/tasks by partial or approximate name match. Useful when you
          don't remember the exact slug or title.


          Behavior:

          - Matches against title, slugs, and description

          - Returns results scored by relevance

          - Configurable threshold for match quality

          - Works with existing filters (--type, --tag, etc.)


          Examples:

          - kspec item list --fuzzy 'validashun' → finds @validation-modes

          - kspec tasks list --fuzzy 'sesion' → finds session-related tasks
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-15T17:11:58.428Z'
      - _ulid: 01KF1A991VFFQ99EBQGQ9XB55D
        slugs:
          - fuzzy-command-suggest
        title: CLI Command Suggestions on Error
        type: requirement
        tags:
          - dx
          - cli
          - errors
        description: |-
          When user enters an invalid command, suggest close matches.

          Behavior:
          - On unknown command, compute distance to all valid commands
          - If close match found (e.g., 'task list' vs 'tasks list'), suggest it
          - Threshold-based: only suggest if match is close enough
          - Also handles subcommand typos (e.g., 'inbox ad' → 'inbox add')

          Output format:
            error: Unknown command 'task list'
            Did you mean: kspec tasks list?

          Consider also accepting common aliases:
          - 'task' as alias for 'tasks' (singular/plural flexibility)
          - 'ls' as alias for 'list'
          - Other common patterns from git/npm conventions
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-15T17:12:08.507Z'
  - _ulid: 01KF3M0JFKF5578HVXEE99F0ZT
    slugs:
      - auto-cli-docs
    title: Auto-Generated CLI Documentation
    type: feature
    tags:
      - dx
      - documentation
    description: >-
      CLI help system that auto-generates command syntax from Commander.js definitions. Eliminates
      manual sync between code and documentation. Combines auto-generated syntax with curated
      conceptual content.
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    created: '2026-01-16T14:40:37.876Z'
    acceptance_criteria:
      - id: ac-1
        given: The CLI program is registered with commands
        when: extractCommandTree() is called
        then: Returns complete tree with names, descriptions, options, arguments, and subcommands
      - id: ac-2
        given: A help topic exists for the 'task' command group
        when: '''kspec help task'' is run'
        then: >-
          The Commands section dynamically lists ALL current task subcommands including recent
          additions
      - id: ac-3
        given: The CLI has multiple command groups
        when: '''kspec help --all'' is run'
        then: Output shows every command with all options and descriptions as a full reference
      - id: ac-4
        given: An agent needs structured CLI documentation
        when: '''kspec help --json'' is run'
        then: Returns JSON with complete command tree for programmatic consumption
      - id: ac-5
        given: A new subcommand is added to Commander definition
        when: '''kspec help <parent>'' is run without updating help.ts'
        then: The new subcommand appears in help output automatically
  - _ulid: 01KF3TSGAKQDNG8NXK90P9Z98J
    slugs:
      - test-derive-hint
    title: Test derive hint
    type: feature
    tags: []
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    created: '2026-01-16T16:39:06.324Z'
requirements:
  - _ulid: 01KF109BR2PZACTM1Y91NWEEJQ
    slugs:
      - cmd-session-checkpoint
    title: kspec session checkpoint
    type: requirement
    tags: []
    description: >-
      Pre-stop hook for Claude Code integration.


      Checks for uncommitted work before allowing session to end:

      - Uncommitted git changes (staged, unstaged, untracked)

      - Tasks in in_progress status

      - Incomplete todos on active tasks


      One-time trigger: Reads stop_hook_active from Claude Code stdin JSON to detect retry. First
      trigger blocks with instructions, subsequent triggers allow stop.


      Output: JSON formatted for Claude Code hook consumption with clear kspec-branded message
      instructing agent to document progress and commit changes. Uses {"decision": "block",
      "reason": "..."} format.


      Installation: kspec setup automatically installs this hook to project-level
      .claude/settings.json for Claude Code users. Hook format requires matcher field (even if empty
      string).


      Acceptance Criteria:

      - AC1: Instructions are numbered sequentially based on which issues apply (dynamic numbering,
      not hardcoded)

      - AC2: Only relevant instructions shown (e.g., if no in_progress tasks, those steps are
      omitted)

      - AC3: Exit silently with no output when session can end cleanly
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    created: '2026-01-15T14:17:25.508Z'
    status:
      maturity: draft
      implementation: implemented
    requirements:
      - _ulid: 01KF1D9G8HNSYRTPTPZZ4NVXJ1
        slugs:
          - cmd-session-prompt-check
        title: kspec session prompt-check
        type: requirement
        tags: []
        description: >-
          UserPromptSubmit hook for spec-first workflow reinforcement.


          Outputs a lean reminder on every user prompt: '[kspec] Before implementing behavior
          changes, check spec coverage. Update spec first if needed.'


          Design rationale:

          - Always injects (no filtering) - Claude is smart enough to apply when relevant

          - Minimal token overhead - short, instructive message

          - Non-blocking - context injection, not gating


          Installation: kspec setup automatically installs this hook alongside session checkpoint to
          project-level .claude/settings.json for Claude Code users.


          Acceptance Criteria:

          - AC1: Outputs single-line reminder to stdout

          - AC2: No stdin parsing required (stateless)

          - AC3: Installed by setup command as UserPromptSubmit hook
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-15T18:04:41.618Z'
  - _ulid: 01KF2C5P8BGYKT9GDTYNXTSTQM
    slugs:
      - cmd-session-start
    title: kspec session start
    type: requirement
    tags: []
    description: >-
      Display session context for starting work. Shows: active tasks, recently completed, ready
      tasks, inbox items, recent commits, working tree status. Options: --brief (default), --full,
      --since <time>, --no-git, -n <limit>. Output is human-readable with sections for each context
      type. Designed as the first command agents run to orient themselves.
    depends_on: []
    implements: []
    relates_to: []
    tests: []
    created: '2026-01-16T03:04:22.540Z'
    requirements:
      - _ulid: 01KF2C60QQP8CT8F77PTRGQ7YB
        slugs:
          - session-start-hints
        title: Contextual Command Hints
        type: requirement
        tags: []
        description: >-
          Add a 'Quick Commands' section to session start output showing relevant commands based on
          current state. Commands are contextual: task note/complete when active work exists, task
          start when ready tasks available, inbox promote for oldest inbox item, git commit when
          working tree dirty. Uses actual refs from session context for copy-paste convenience.
        depends_on: []
        implements: []
        relates_to: []
        tests: []
        created: '2026-01-16T03:04:33.272Z'
        status:
          maturity: draft
          implementation: implemented
        acceptance_criteria:
          - id: ac-1
            given: ready tasks exist in the project
            when: kspec session start runs
            then: Quick Commands section shows 'kspec task start @ref' hint
          - id: ac-2
            given: a task is in progress
            when: kspec session start runs
            then: Quick Commands section shows task note and complete hints
    status:
      implementation: implemented
